{% extends "home/base.html" %} 
{% load static %} 
{% csrf_token %} 
{% block addon_css %}

<link rel="stylesheet" href="{% static 'home/css/bootstrap2-toggle.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/yadcf_bootstrap_version.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/select2.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/modal.css' %}" type="text/css" />
<!--This is for the filter, min max, pagination styling -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.css" />
<link rel="stylesheet" href="{% static 'home/css/construct_browser.css' %}" type="text/css" />

<style>

  .dataTables_scrollHeadInner {
		margin-top: 20px;
	}

	table.dataTable thead th,
	table.dataTable tbody td {
		max-width: 65px;
		word-break: break-all;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	table.dataTable thead .sorting {
		background-position: right;
	}

	.select2-container select2-container-multi {
		width: 75%;
	}

	.select2-container-multi .select2-choices .select2-search-field input {
		max-width: 50px;
	}

	.yadcf-filter-wrapper {
		position: center;
		display: flex;
		white-space: nowrap;
		margin-top: 7px;
		width: 50% !important;
	}

	.yadcf-filter-wrapper-inner {
		white-space: normal;
	}

	.select2-results {
		background-color: white;
		border: gray;
		width: 150px !important;
	}

	.yadcf-filter-range {
		grid-auto-columns: auto;
		max-width: 50px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		margin: auto;
		margin-top: 10%;
		min-width: 40px;
	}

	table.dataTable.compact tbody th,
	table.dataTable.compact tbody td {
		padding: 5px 10px 5px 0px !important;
		/* width: 0px; */
	}

	table.dataTable.compact thead th,
	table.dataTable.compact thead td {
		padding: 5px 10px 5px 0px;
		/* width: 0px; */
	}

	table.dataTable.compact thead tr.over_header th {
		border-bottom: 1px solid #ccc;
	}

	table.dataTable.compact thead th.leftborder {
		border-left: 1px solid;
	}

	table.dataTable.compact thead th.rightborder {
		border-right: 1px solid;
	}

	.yadcf-filter-range {
		grid-auto-columns: auto;
		max-width: 50px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		margin: auto;
		margin-top: 10%;
		min-width: 40px;
	}

	.yadcf-filter-range {
		max-width: 40px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		min-width: 40px;
	}

	#overlay {
		top: 0px;
		position: absolute;
		background: #f8f8f8;
		/*border: 1px solid #333;*/
		-webkit-box-shadow: 5px 0 2px -2px #888;
		box-shadow: 5px 0 2px -2px #888;
	}

	.container {
		width: 90%;
		/* display:flex;
            flex-direction: column; */
	}

	.wrapper {
		overflow-x: scroll;
		overflow-y: hidden;
	}

	#overlay tbody tr {
		background-color: #f8f8f8;
	}

	#count_row th {
		font-size: 11px;
		text-align: center;
	}

	.border-left {
		padding-left: 3px;
	}

	.name {
		width: 100px;
		text-overflow: ellipsis;
		cursor: pointer;
		word-break: break-all;
		overflow: hidden;
		white-space: nowrap;
	}

	.name:hover {
		overflow: visible;
		white-space: normal;

	}

	.toolbar_data_css {
		width: 250px;
		margin-right: auto;
		margin-left: 0px;
		/* border: 1px solid; */
		font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
		font-weight: normal;
		font-size: 120%;
		line-height: 1.625;
	}

	.toolbar_data_css.td {
		height: 15px;
		max-width: 150px;
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
	}
  
  table,
  th,
  td {
    
    border-collapse: collapse;
    padding: 2px;
  }
  tr:hover {
    background-color: rgb(237, 237, 233);
  }
  #variant_consquence_statistics{
    margin-top: 10px;
    display: flex;
    {% comment %} background-color: lavender; {% endcomment %}
    justify-content: space-between;
    border: 1px solid grey;
  }

  #variant_consquence_statistics_in_words{
    margin-top: 50px;
    margin-left: 10px;
  }

  #structures_scrollable_table{
    margin-top: 10px;
    max-width: 100%;
  }

</style>
{% endblock addon_css %} 


{% block scripts %}
<script>
		// Script for DataTable
    $(document).ready(function() {
      
      $("#structures_scrollable").show();
      oTable1 = $("#structures_scrollable").DataTable({
        deferRender: true,
        scrollY: true,
        scrollX: true,
        scrollCollapse: true,
        scroller: true,
        paging: true,
        bSortCellsTop: false, //prevent sort arrows going on bottom row
        aaSorting: [],
        autoWidth: true,
        bInfo: true,
        order: [[7, "asc"]],
        pagingType: 'full_numbers',
        lengthMenu: [
            [10, 25, 50, -1],
            [10, 25, 50, 'All'],
        ],
      })
			
      let column_filters = [];
      // Consequence
      column_filters = column_filters.concat(createYADCFfilters(6, 1, "multi_select", "select2", "Consequence", false, null, null, "80px"));

      // Impact 
      column_filters = column_filters.concat(createYADCFfilters(7, 1, "multi_select", "select2", "Impact", false, null, null, "80px"));

      yadcf.init(oTable1.draw(), column_filters, {
        cumulative_filtering: false
      });
      yadcf.exFilterColumn(oTable1, [[7, ["HIGH"]]], true);

      gray_scale_table($("#structures_scrollable"));

      $("#reset").click(function() {
        yadcf.exResetAllFilters(oTable1);
      });

      });

		// Script for the drug-protein network
		{% comment %} var dataset =  [{text:"Established", value: {{drugtargets_approved|length}}},
                {text:"Reached clinical trials", value: {{in_trial}}},
                {text:"Non-targeted", value: {{not_targeted}}}]; {% endcomment %}
		
		
		var interactions = []
	
		{% comment %} {% for value in Array %}
			interaction={
				interacting_protein:value.0,
				interaction_type:value.1,
			}
			interactions.push(interaction);
		{% endfor%} {% endcomment %}

		{% comment %} var tooltip = d3.select("body")
								.append("div")
								.style("position", "absolute")
								.style("z-index", "10")
								.style("visibility", "hidden")
								.style("color", "white")
								.style("padding", "8px")
								.style("background-color", "rgba(0, 0, 0, 0.75)")
								.style("border-radius", "6px")
								.style("font", "12px sans-serif")
								.text("tooltip");

		var interaction_network = d3.select("body").selectAll("g")
  						.data(interactions)
  						.enter().append("g")
							.style("width", "800px")
							.style("height", "600px")
							.style("background-color", "rgba(0, 0, 0, 0.75)")
							.style("font", "12px sans-serif");

		interaction_network.append("circle")
		.attr("r",  100)
		.attr("y", 10) // rounded corners
		.attr("x", function(d) {
			return d;
		})
		.attr("fill",  "lavender" )
		.on("mouseover", function(){return tooltip.style("visibility", "hidden")}); {% endcomment %}
		// Set the dimensions of the canvas
		//alert("before drawing");
		// Set the dimensions of the canvas
var width = 500,
height = 500;

// Set the radius of the center node
var centerNodeRadius = 70;

// Set the radius of the other nodes
var nodeRadius = 50;

// Set the distance between the center node and the other nodes
var nodeDistance = 170;

// Set the number of nodes
var numNodes = {{length}};

// Set the container element and its background color
var container = d3.select("body")
							.append("div")
							.attr("class", "interaction_container")
							.style("width", 700)
							.style("height", 700);

// Create a svg element to draw the nodes
var svg = container.append("svg")
								.attr("width", width)
								.attr("height", height);

// Create the links between the center node and the other nodes
var links = svg.selectAll(".link")
					 .data(d3.range(numNodes))
					 .enter()
					 .append("line")
					 .attr("class", "link")
					 .style("stroke", "black");

// Set the position of the links
links.attr("x1", width / 2)
 .attr("y1", height / 2)
 .attr("x2", function(d, i) {
	 return width / 2 + nodeDistance * Math.cos(2 * Math.PI * i / numNodes);
 })
 .attr("y2", function(d, i) {
	 return height / 2 + nodeDistance * Math.sin(2 * Math.PI * i / numNodes);
 });

// Create the center node
//console.log({{drugname}}); 
var centerNode = svg.append("ellipse")
								.attr("cx", width / 2)
								.attr("cy", height / 2)
								.attr("rx", centerNodeRadius)
								.attr("ry", centerNodeRadius / 2)
								.style("fill", "#73D2DE");
								//.text({{drugname}});

svg.append("text")
	.attr("x",width / 2-30)
	.attr("y",height / 2+5)
	.text('{{drugname}}');
								

// Create the other nodes
var nodes = svg.selectAll(".node")
					 .data(d3.range(numNodes))
					 .enter()
					 .append("ellipse")
					 .attr("class", "node")
					 .attr("rx", nodeRadius)
					 .attr("ry", nodeRadius/2)
					 .style("fill", "#FFBC42");
					 
// Set the position of the other nodes
nodes.attr("cx", function(d, i) {
return width / 2 + nodeDistance * Math.cos(2 * Math.PI * i / numNodes);
})
.attr("cy", function(d, i) {
return height / 2 + nodeDistance * Math.sin(2 * Math.PI * i / numNodes);
});

var array_list = {{ test|safe }};
for (i=0; i < array_list.length; i++) 
{
	svg.append("text")
		.attr("x", width / 2 + nodeDistance * Math.cos(2 * Math.PI * i / numNodes)-20)
		.attr("y", height / 2 + nodeDistance * Math.sin(2 * Math.PI * i / numNodes)+5)
		.text(array_list[i]['gene_name']); 
} 
</script>

{% endblock scripts %}


{% block content %} 
{% autoescape off %}

<div style="padding-top: 0px; font-size: 14px; white-space: nowrap; overflow-y:hidden; width: 100%">
  <br />

  <div style="font-size: 12px">
    <p>
      Data showed in this table is collected from the <a href='//go.drugbank.com/' target='_blank'>Drugbank</a> database and <a href='https://www.uniprot.org/' target='_blank'>UniProt</a>
    </p>
  </div>
  <a id="dlink" style="display: none"></a>
  <div id="excel_table" style2="display:none;"></div>

  <button
    onclick="tableToExcel('structures_scrollable', 'Families data', 'EndogenousData.xls')"
    type="button"
    class="btn btn-primary"
    style="margin-top: 10px; margin-top: 3px"
  >
    Export to Excel
  </button>

  <button
    id="reset"
    type="button"
    class="btn btn-primary"
    style="margin-top: 10px; margin-top: 3px"
  >
    Reset filters
  </button>

  <p style="margin-top:10px;margin-bottom:10px;color:#014F86">Interactions for {{drugname}} (drugbank ID =  {{drugID}})</p>

  <div id="structures_scrollable_table">
    <table class="display compact text-nowrap" id="structures_scrollable" style="width: 100%; margin-top: 10px; font-size: 12px;">
      <thead id="headers">
        <tr class="table-filter-dropdown">
          <!-- Position blok -->
					<th class="pathways" style="text-align: left">Drugtype</th>
          <th class="pathways" style="text-align: left">Interacting <br> protein</th>
          <th class="pathways" style="text-align: left">Interaction <br> type</th>
          
          <th class="pathways" style="text-align: left">UniProt <br> accession</th>
          <th class="pathways" style="text-align: left">Target <br> gene</th>
          <th class="pathways" style="text-align: left">Clinical status</th>
          <th class="pathways" style="text-align: left">Year of approval</th>
          <th class="pathways" style="text-align: left">Phase</th>
					<th class="pathways" style="text-align: left">Status</th>
          <th class="pathways" style="text-align: left">Mechanism of action</th>
          <th class="color-column" style="text-align: left">#Variants</th>
          
        </tr>

      </thead>
      <tbody id='structures_scrollable_body'>
        {% for value in Array %}
        <tr>
					<td style="text-align: left">{{value.2}}</td>
          <td style="text-align: left">{{value.0}}</td>
          <td style="text-align: left">{{value.1}}</td> 
          <td style="text-align: left">{{value.3}}</td>
          <td style="text-align: left">{{value.4}}</td>
          <td style="text-align: left">{{value.5}}</td>
          <td style="text-align: left">{{value.5}}</td>
          <td style="text-align: left">{{value.5}}</td>
          <td style="text-align: left">{{value.5}}</td>
					<td style="text-align: left">{{value.5}}</td>
          <td style="text-align: left">{{value.5}}</td>
          
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <br />
  </div>
	</div> 

	{% comment %} <div id="connected-graph">
		{% include "connected-graph.html" %}
	</div>  {% endcomment %}
</div>
{% endautoescape %} 
{% endblock content%}

{% block addon_js %}
<script src="{% static 'home/js/jquery-3.1.1.min.js' %}"></script>
<script src="{% static 'home/js/jquery-ui.min.js' %}"></script>
<script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"> </script>
<script src="{% static 'home/js/datatables.min.js' %}"> </script>
<script src="{% static 'home/js/bootstrap2-toggle.min.js' %}"></script>
<script src="{% static 'home/js/dataTables.buttons.min.js' %}"> </script>
<script src="{% static 'home/js/select2.js' %}"> </>
<script src="{% static 'home/js/grayscale.js' %}"></script>
<script src="{% static 'home/js/gpcrdb.js' %}"></script>
<script src="{% static 'home/js/signprot-multitabtable.js' %}"></script>
<script src="{% static 'home/js/d3.min.js' %}"></script>
<script src="{% static 'home/js/d3pie.js' %}"></script>
<script src="{% static 'home/js/nv.d3.min.js' %}"></script>
{% endblock addon_js %}  
