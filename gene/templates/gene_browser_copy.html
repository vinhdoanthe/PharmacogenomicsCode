{% extends "home/base.html" %} 
{% load static %} 
{% csrf_token %} 
{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/jquery.dataTables.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/bootstrap2-toggle.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/yadcf_bootstrap_version.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/select2.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/modal.css' %}" type="text/css" />
<!--This is for the filter, min max, pagination styling -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.css" />
<link rel="stylesheet" href="{% static 'home/css/construct_browser.css' %}" type="text/css" />

<style>

  .dataTables_scrollHeadInner {
		margin-top: 20px;
	}

	table.dataTable thead th,
	table.dataTable tbody td {
		max-width: 65px;
		word-break: break-all;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	table.dataTable thead .sorting {
		background-position: right;
	}

	.select2-container select2-container-multi {
		width: 75%;
	}

	.select2-container-multi .select2-choices .select2-search-field input {
		max-width: 50px;
	}

	.yadcf-filter-wrapper {
		position: center;
		display: flex;
		white-space: nowrap;
		margin-top: 7px;
		width: 50% !important;
	}

	.yadcf-filter-wrapper-inner {
		white-space: normal;
	}

	.select2-results {
		background-color: white;
		border: gray;
		width: 150px !important;
	}

	.yadcf-filter-range {
		grid-auto-columns: auto;
		max-width: 50px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		margin: auto;
		margin-top: 10%;
		min-width: 40px;
	}

	table.dataTable.compact tbody th,
	table.dataTable.compact tbody td {
		padding: 5px 10px 5px 0px !important;
		/* width: 0px; */
	}

	table.dataTable.compact thead th,
	table.dataTable.compact thead td {
		padding: 5px 10px 5px 0px;
		/* width: 0px; */
	}

	table.dataTable.compact thead tr.over_header th {
		border-bottom: 1px solid #ccc;
	}

	table.dataTable.compact thead th.leftborder {
		border-left: 1px solid;
	}

	table.dataTable.compact thead th.rightborder {
		border-right: 1px solid;
	}

	.yadcf-filter-range {
		grid-auto-columns: auto;
		max-width: 50px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		margin: auto;
		margin-top: 10%;
		min-width: 40px;
	}

	.yadcf-filter-range {
		max-width: 40px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		min-width: 40px;
	}

	#overlay {
		top: 0px;
		position: absolute;
		background: #f8f8f8;
		/*border: 1px solid #333;*/
		-webkit-box-shadow: 5px 0 2px -2px #888;
		box-shadow: 5px 0 2px -2px #888;
	}

	.container {
		width: 90%;
		/* display:flex;
            flex-direction: column; */
	}

	.wrapper {
		overflow-x: scroll;
		overflow-y: hidden;
	}

	#overlay tbody tr {
		background-color: #f8f8f8;
	}

	#count_row th {
		font-size: 11px;
		text-align: center;
	}

	.border-left {
		padding-left: 3px;
	}

	.name {
		width: 100px;
		text-overflow: ellipsis;
		cursor: pointer;
		word-break: break-all;
		overflow: hidden;
		white-space: nowrap;
	}

	.name:hover {
		overflow: visible;
		white-space: normal;

	}

	.toolbar_data_css {
		width: 250px;
		margin-right: auto;
		margin-left: 0px;
		/* border: 1px solid; */
		font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
		font-weight: normal;
		font-size: 120%;
		line-height: 1.625;
	}

	.toolbar_data_css.td {
		height: 15px;
		max-width: 150px;
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
	}
  
  table,
  th,
  td {
    
    border-collapse: collapse;
    padding: 2px;
  }
  tr:hover {
    background-color: rgb(237, 237, 233);
  }
  #variant_consquence_statistics{
    margin-top: 10px;
    display: flex;
    {% comment %} background-color: lavender; {% endcomment %}
    justify-content: space-between;
    border: 1px solid grey;
		flex-direction: column;
  }

  #variant_consquence_statistics_in_words{
    margin-top: 50px;
    margin-left: 10px;
  }

  #structures_scrollable_table{
    margin-top: 10px;
    max-width: 100%;
  }

</style>
{% endblock addon_css %} 


{% block content %} 
{% autoescape off %}

<div style="padding-top: 0px; font-size: 14px; white-space: nowrap; overflow-y:hidden; width: 100%">
  <br />

  <div style="font-size: 12px">
    <p>
      Data showed in this table is collected from the
      <a href="https://www.ensembl.org" target="_blank">Ensembl</a> database and
      <a href="https://gnomad.broadinstitute.org/" target="_blank">Gnomad</a>
    </p>
  </div>
  <a id="dlink" style="display: none"></a>
  <div id="excel_table" style2="display:none;"></div>

  <button
    onclick="tableToExcel('structures_scrollable', 'Families data', 'EndogenousData.xls')"
    type="button"
    class="btn btn-primary"
    style="margin-top: 10px; margin-top: 3px"
  >
    Export to Excel
  </button>

  <button
    id="reset"
    type="button"
    class="btn btn-primary"
    style="margin-top: 10px; margin-top: 3px"
  >
    Reset filters
  </button>

  <button
    id="statistics"
    type="button"
    class="btn btn-primary"
    style="margin-top: 10px; margin-top: 3px"
  >
    Show statistics
  </button>

  <div id="structures_scrollable_table">
    <table class="display compact text-nowrap" id="structures_scrollable" style="width: 100%; margin-top: 10px; font-size: 10px;">
      <thead id="headers">
        <tr class="header-spans">
          <th style="text-align:left" colspan="8">Position</th>
          <th style="border-left: 1px solid black; text-align:left" colspan="2" style="">Impact</th>
          <th style="border-left: 1px solid black; text-align:left" colspan="40"> Predicted effect scores</th>
        </tr>

        <tr class="table-filter-dropdown">
          <!-- Position block -->
          <th class="pathways" style="text-align: left">Variant</th>
          <th class="pathways" style="text-align: left">Transcript</th>
          <th class="pathways" style="text-align: left">cDNA_</br>position</th>
          <th class="pathways" style="text-align: left">CDS_</br>position</th>
          <th class="pathways" style="text-align: left">Protein_</br>position</th>
          <th class="pathways" style="text-align: left">Amino_</br>acids</th>
          <th class="pathways" style="text-align: left">Codons</th>
          <th class="pathways" style="text-align: left">Strand</th>
          <!-- Impact block -->
          <th class="pathways" style="text-align: left">Conse_</br>quence</th>
          <th class="pathways" style="text-align: left">Impact</th>
          <!-- Score block -->
          <th class="color-column" style="text-align: left">BayesDel_</br>addAF_</br>rankscore</th>
					<th class="color-column" style="text-align: left">BayesDel_</br>noAF_</br>rankscore</th>
					<th class="color-column" style="text-align: left">CADD_</br>raw_</br>rankscore</th>
					<th class="color-column" style="text-align: left">ClinPred_</br>rankscore</th>
					<th class="color-column" style="text-align: left">DANN_</br>rankscore</th>

					<th class="color-column" style="text-align: left">DEOGEN2_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Eigen_PC_</br>raw_coding_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Eigen_raw_</br>coding_</br>rankscore</th>
					<th class="color-column" style="text-align: left">FATHMM_</br>converted_</br>rankscore</th>
					<th class="color-column" style="text-align: left">GERP_RS_</br>rankscore</th>

					<th class="color-column" style="text-align: left">GM12878_</br>fitCons_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Geno</br>Canyon_</br>rankscore</th>
					<th class="color-column" style="text-align: left">H1_hESC_</br>fitCons_</br>rankscore</th>
					<th class="color-column" style="text-align: left">HUVEC_</br>fitCons_</br>rankscore</th>
					<th class="color-column" style="text-align: left">LIST_S2_</br>rankscore</th>

					<th class="color-column" style="text-align: left">LRT_</br>converted_</br>rankscore</th>
					<th class="color-column" style="text-align: left">M_CAP_</br>rankscore</th>
					<th class="color-column" style="text-align: left">MPC_</br>rankscore</th>
					<th class="color-column" style="text-align: left">MVP_</br>rankscore</th>
					<th class="color-column" style="text-align: left">MetaLR_</br>rankscore</th>

					<th class="color-column" style="text-align: left">MetaRNN_</br>rankscore</th>
					<th class="color-column" style="text-align: left">MetaSVM_</br>rankscore</th>
					<th class="color-column" style="text-align: left">MutPred_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Mutation</br>Assessor_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Mutation</br>Taster_</br>converted_</br>rankscore</th>

					<th class="color-column" style="text-align: left">PROVEAN_</br>converted_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Polyphen2_</br>HDIV_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Polyphen2_</br>HVAR_</br>rankscore</th>
					<th class="color-column" style="text-align: left">PrimateAI_</br>rankscore</th>
					<th class="color-column" style="text-align: left">REVEL_</br>rankscore</th>

					<th class="color-column" style="text-align: left">SIFT4G_</br>converted_</br>rankscore</th>
					<th class="color-column" style="text-align: left">SIFT_</br>converted_</br>rankscore</th>
					<th class="color-column" style="text-align: left">SiPhy_</br>29way_</br>logOdds_</br>rankscore</th>
					<th class="color-column" style="text-align: left">VEST4_</br>rankscore</th>
					<th class="color-column" style="text-align: left">bStatistic</br>converted_</br>rankscore</th>

					<th class="color-column" style="text-align: left">Fathmm_</br>MKL_coding_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Fathmm_XF</br>_coding_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Integrated_</br>fitCons_</br>rankscore</th>
					<th class="color-column" style="text-align: left">PhastCons</br>30way_</br>mammalian_</br>rankscore</th>
					<th class="color-column" style="text-align: left">Phylo_</br>P30way_</br>mammalian_</br>rankscore</th>
        </tr>

      </thead>
      <tbody id='structures_scrollable_body'>
        {% for value in array|slice:":300" %}
        {% comment %} {% for value in array %} {% endcomment %}
        <tr>
          <td style="text-align: left">{{value.0}}</td>
					<td style="text-align: left">{{value.1}}</td>
					<td style="text-align: left">{{value.3}}</td>
					<td style="text-align: left">{{value.4}}</td>
					<td style="text-align: left">{{value.5}}</td>
					<td style="text-align: left">{{value.6}}</td>
					<td style="text-align: left">{{value.7}}</td>
					<td style="text-align: left">{{value.9}}</td>
					<td style="text-align: left">{{value.2}}</td>
					<td style="text-align: left">{{value.8}}</td>
					<td style="text-align: left">{{value.10}}</td>
					<td style="text-align: left">{{value.11}}</td>
					<td style="text-align: left">{{value.12}}</td>
					<td style="text-align: left">{{value.13}}</td>
					<td style="text-align: left">{{value.14}}</td>
					<td style="text-align: left">{{value.15}}</td>
					<td style="text-align: left">{{value.16}}</td>
					<td style="text-align: left">{{value.17}}</td>
					<td style="text-align: left">{{value.18}}</td>
					<td style="text-align: left">{{value.19}}</td>
					<td style="text-align: left">{{value.20}}</td>
					<td style="text-align: left">{{value.21}}</td>
					<td style="text-align: left">{{value.22}}</td>
					<td style="text-align: left">{{value.23}}</td>
					<td style="text-align: left">{{value.24}}</td>
					<td style="text-align: left">{{value.25}}</td>
					<td style="text-align: left">{{value.26}}</td>
					<td style="text-align: left">{{value.27}}</td>
					<td style="text-align: left">{{value.28}}</td>
					<td style="text-align: left">{{value.29}}</td>
					<td style="text-align: left">{{value.30}}</td>
					<td style="text-align: left">{{value.31}}</td>
					<td style="text-align: left">{{value.32}}</td>
					<td style="text-align: left">{{value.33}}</td>
					<td style="text-align: left">{{value.34}}</td>
					<td style="text-align: left">{{value.35}}</td>
					<td style="text-align: left">{{value.36}}</td>
					<td style="text-align: left">{{value.37}}</td>
					<td style="text-align: left">{{value.38}}</td>
					<td style="text-align: left">{{value.39}}</td>
					<td style="text-align: left">{{value.40}}</td>
					<td style="text-align: left">{{value.41}}</td>
					<td style="text-align: left">{{value.42}}</td>
					<td style="text-align: left">{{value.43}}</td>
					<td style="text-align: left">{{value.44}}</td>
					<td style="text-align: left">{{value.45}}</td>
					<td style="text-align: left">{{value.46}}</td>
					<td style="text-align: left">{{value.47}}</td>
					<td style="text-align: left">{{value.48}}</td>
					<td style="text-align: left">{{value.49}}</td>
				
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <br />
  </div>

	<div id="variant_consquence_statistics">
    <div id="variant_consquence_statistics_in_words">
      <p>Total number of variants: <span style="color: blue">{{length}}</span></p>
		<p>
			Total number of missense_variant:
			<span style="color: red">{{missense_variant}}</span>
		</p>
		<p>
			Total number of upstream_gene_variant:
			<span style="color: red">{{upstream_gene_variant}}</span>
		</p>
		<p>
			Total number of intron_variant:
			<span style="color: red">{{intron_variant}}</span>
		</p>
		<p>
			Total number of non_coding_transcript_variant:
			<span style="color: red">{{non_coding_transcript_variant}}</span>
		</p>
		<p>
			Total number of synonymous_variant:
			<span style="color: red">{{synonymous_variant}}</span>
		</p>
		<p>
			Total number of incomplete_terminal_codon_variant:
			<span style="color: red">{{incomplete_terminal_codon_variant}}</span>
		</p>
		<p>
			Total number of coding_sequence_variant:
			<span style="color: red">{{coding_sequence_variant}}</span>
		</p>
		<p>
			Total number of downstream_gene_variant:
			<span style="color: red">{{downstream_gene_variant}}</span>
		</p>
		<p>
			Total number of stop_gained variant:
			<span style="color: red">{{stop_gained}}</span>
		</p>
    </div>
    // include "consequence_piechart.html"
    <div id="gene_piechart">
      {% include "consequence_piechart.html" %}
    </div>
		// end of "consequence_piechart.html"
    //include "variant_heatmap.html"
		<div id="gene_variant_heatmap">
			{% include "variant_heatmap.html" %}
		</div>
		//end of  "variant_heatmap.html"

		
	</div>  
</div>
{% endautoescape %} 
{% endblock content%}

{% block addon_js %}
//addon_js from gene_browser.html
<script src="{% static 'home/js/datatables.min.js' %}"> </script>
<script src="{% static 'home/js/bootstrap2-toggle.min.js' %}"></script>
{% comment %} <script src="{% static 'home/js/jquery.dataTables.min.js' %}"> </script> {% endcomment %}
<script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"> </script>
<script src="{% static 'home/js/dataTables.buttons.min.js' %}"> </script>
<script src="{% static 'home/js/select2.js' %}"> </script>
<script src="{% static 'home/js/grayscale.js' %}"></script>
<script src="{% static 'home/js/gpcrdb.js' %}"></script>
<script src="{% static 'home/js/signprot-multitabtable.js' %}"></script>
<script>
  
	$(document).ready(function() {
		
		$("#structures_scrollable").show();
		oTable1 = $("#structures_scrollable").DataTable({
			deferRender: true,
			scrollY: true,
			scrollX: true,
			scrollCollapse: true,
			scroller: true,
			paging: true,
			bSortCellsTop: false, //prevent sort arrows going on bottom row
			aaSorting: [],
			autoWidth: true,
			bInfo: true,
			//order: [[7, "asc"]],
			pagingType: 'full_numbers',
			lengthMenu: [
					[10, 25, 50, 100, 200, -1],
					[10, 25, 50, 100, 200, 'All'],
			],
		})
		
		let column_filters = [];

		// Variant
		column_filters = column_filters.concat(createYADCFfilters(0, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// Transcript
		column_filters = column_filters.concat(createYADCFfilters(1, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// cDNA_position
		column_filters = column_filters.concat(createYADCFfilters(2, 1, "multi_select", "select2", 'Select', false, null, null, "80px"));

		// CDS_position
		column_filters = column_filters.concat(createYADCFfilters(3, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// Protein_position
		column_filters = column_filters.concat(createYADCFfilters(4, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// Amino_acids
		column_filters = column_filters.concat(createYADCFfilters(5, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// Codons
		column_filters = column_filters.concat(createYADCFfilters(6, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// Consequence
		column_filters = column_filters.concat(createYADCFfilters(8, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// Impact 
		column_filters = column_filters.concat(createYADCFfilters(9, 1, "multi_select", "select2", "Select", false, null, null, "80px"));

		// BayesDel_addAF_rankscore 
		column_filters = column_filters.concat(createYADCFfilters(10, 40, "range_number", null, ["Min", "Max"], false, null, null, "40px"))

		yadcf.init(oTable1.draw(), column_filters, {
			cumulative_filtering: false
		});

		//yadcf.exFilterColumn(oTable1, [[8, ["mis"]]], true);

		gray_scale_table($("#structures_scrollable"));
		console.log("We are here");
		$("#reset").click(function() {
			yadcf.exResetAllFilters(oTable1);
		});

		});
</script>
{% endblock addon_js %}  
